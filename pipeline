pipeline{
agent any
environment{
    DOCKERTAG = getdockertag() 
}
stages{
    stage('docker build image'){
        steps{
            sh "docker build . -t demo/image:${DOCKERTAG}"
        }
    }
    stage('docker image push '){
        steps{
            withCredentials([string(credentialsId: 'ahadwaqar', variable: 'dockerhubpwd')]) {
                sh "docker login -u ahadwaqar -p ${dockerhubpwd}"
                sh "docker push demo/image:${DOCKERTAG}"
            }
        }
    }

}

}
def getdockertag(){
    def newtag = sh script: 'git rev-parse HEAD' , returnStdout: true
    return newtag
}